<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  </style>
  <title>Clario Video</title>
  <meta name="description" content="Canvas-first video generator workspace powered by Veo 3 (scaffold)." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="../styles.css" />
  <link rel="icon" type="image/png" href="../assets/ChatGPT Image Sep 1, 2025, 01_50_19 AM.png" />
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="container nav-inner">
      <a href="/" class="logo" aria-label="Clario home">CLARIO</a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/image/">Image</a>
        <a href="/video/" aria-current="page">Video</a>
        <a href="/#pricing">Pricing</a>
        <a href="/#learn">Learn</a>
      </nav>
      <div id="user-nav" class="user-nav" style="display: none;">
        <img id="user-avatar" class="user-avatar" src="" alt="" />
        <span id="user-name" class="user-name"></span>
        <button id="sign-out" class="btn btn-light">Sign out</button>
      </div>
      <div id="guest-nav" class="guest-nav">
        <a class="btn btn-light" href="/signin.html">Sign in</a>
        <a class="btn btn-dark cta" href="/#pricing">Try Clario</a>
      </div>
    </div>
  </header>

  <main class="editor-shell">
    <div class="container">
      <!-- Top bar -->
      <div class="editor-topbar" role="toolbar" aria-label="Video actions">
        <div class="left">
          <label class="btn btn-light" for="ref-file">Upload Reference Image</label>
          <input id="ref-file" type="file" accept="image/*" hidden />
          <button id="new-btn" class="btn btn-light" aria-label="New video setup">New</button>
        </div>
        <div class="center">
          <h1 class="editor-title">Clario Video</h1>
        </div>
        <div class="right">
          <div class="btn-group" role="group" aria-label="Export group">
            <button id="export-webm" class="btn btn-light" disabled>Export WebM</button>
            <button id="export-mp4" class="btn btn-light" title="MP4 export requires server-side encoding" disabled>Export MP4</button>
          </div>
          <button id="history-btn" class="btn btn-light" aria-expanded="true">History</button>
        </div>
      </div>

      <div class="editor-main video-layout">
        <!-- Center preview -->
        <section class="video-preview-wrap" aria-label="Video preview">
          <div class="preview-inner" style="position:relative;">
            <video id="preview" playsinline controls aria-label="Generated video preview" style="position:relative; width:100%; height:auto; z-index:1;"></video>
            <video id="preview-b" playsinline muted aria-label="Crossfade layer" style="position:absolute; inset:0; width:100%; height:100%; object-fit:contain; opacity:0; pointer-events:none; z-index:2;"></video>
            <div id="loading" class="loading-overlay" aria-hidden="true">
              <div class="spinner" aria-hidden="true"></div>
              <div class="loading-text">Generating video‚Ä¶</div>
              <div class="progress">
                <div class="bar" style="width:0%"></div>
              </div>
            </div>
          </div>
          
          <div class="upgrade-row">
            <button id="upgrade-btn" class="btn btn-dark">Upgrade to HD Export</button>
          </div>
        </section>

        <!-- Right panel: controls + history -->
        <aside class="editor-panel video-panel">
          <!-- Generation Mode Card -->
          <div class="control-card">
            <div class="card-header">
              <h3>Generation Mode</h3>
            </div>
            <div class="mode-selector">
              <button class="mode-btn" data-mode="prompt-to-video">
                <div class="mode-icon">‚ú®</div>
                <div class="mode-content">
                  <div class="mode-title">Prompt to Video</div>
                </div>
              </button>
              <button class="mode-btn active" data-mode="image-to-video">
                <div class="mode-icon">üé¨</div>
                <div class="mode-content">
                  <div class="mode-title">Image to Video</div>
                </div>
              </button>
            </div>
          </div>

          <!-- Prompt Section (Hidden) -->
          <div id="prompt-section" class="control-card" style="display: none;">
            <div class="card-header">
              <h3>Describe Your Video</h3>
            </div>
            <textarea id="prompt" class="modern-textarea" placeholder="Describe the video you want to create...\ne.g. A cinematic drone shot over a futuristic city at sunset"></textarea>
          </div>

          <!-- Image Section -->
          <div id="image-section" class="control-card" style="display: block;">
            <div class="card-header">
              <h3>Source Image</h3>
            </div>
            <div class="file-upload-area">
              <input type="file" id="source-image" accept="image/*" class="file-input" />
              <label for="source-image" class="file-upload-label">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">
                  <div class="upload-title">Choose an image</div>
                  <div class="upload-subtitle">PNG, JPG up to 10MB</div>
                </div>
              </label>
              <div id="image-preview" class="image-preview"></div>
            </div>
            
            <div class="card-header" style="margin-top: 1.5rem;">
              <h3>Motion Description</h3>
            </div>
            <textarea id="motion-prompt" class="modern-textarea" placeholder="Describe how the image should move...\ne.g. Gentle camera pan from left to right with soft lighting"></textarea>
          </div>

          <!-- Settings Card -->
          <div class="control-card">
            <div class="card-header">
              <h3>Video Settings</h3>
            </div>
            <div class="settings-grid" style="gap: 14px;">
              <div class="setting-item">
                <label for="duration" class="setting-label">Duration</label>
                <select id="duration" class="modern-select">
                  <option value="8">8 seconds</option>
                </select>
              </div>
              
              <div class="setting-item">
                <label for="tier" class="setting-label">Quality</label>
                <select id="tier" class="modern-select">
                  <option value="fast" selected>Clario Fast</option>
                  <option value="advanced">Clario Advanced</option>
                </select>
              </div>
              
              <div class="setting-item">
                <label for="aspect" class="setting-label">Aspect Ratio</label>
                <select id="aspect" class="modern-select">
                  <option value="16:9">16:9 Landscape</option>
                  <option value="9:16">9:16 Portrait</option>
                </select>
              </div>
              
              <div class="setting-item">
                <label for="resolution" class="setting-label">Resolution</label>
                <select id="resolution" class="modern-select">
                  <option value="480">Preview (480p)</option>
                  <option value="720">Standard (720p)</option>
                  <option value="1080">HD (1080p)</option>
                </select>
              </div>
              
              <div class="setting-item">
                <label for="style" class="setting-label">Style</label>
                <select id="style" class="modern-select">
                  <option value="cinematic">Cinematic</option>
                  <option value="animation">Animation</option>
                  <option value="photoreal">Photorealistic</option>
                </select>
              </div>
              
              <div class="setting-item">
                <label class="setting-label" for="with-audio">Audio</label>
                <label class="modern-checkbox" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="with-audio" style="margin: 0;" />
                  <span style="word-wrap: break-word; line-height: 1.4;">Generate with audio (more credits)</span>
                </label>
              </div>
            </div>
            
            <div class="advanced-settings">
              <details class="advanced-toggle">
                <summary>Advanced Options</summary>
                <div class="setting-item">
                  <label for="seed" class="setting-label">Seed (optional)</label>
                  <input id="seed" type="number" class="modern-input" placeholder="Leave empty for random" />
                </div>
              </details>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="control-card">
            <div class="action-buttons">
              <button id="preview-btn" class="btn btn-primary btn-large">
                <span class="btn-icon">‚ö°</span>
                <div class="btn-content">
                  <div class="btn-title">Generate Preview</div>
                  <div class="btn-subtitle">Free for testing</div>
                </div>
              </button>
              <button id="export-hd-btn" class="btn btn-secondary btn-large">
                <span class="btn-icon">üíé</span>
                <div class="btn-content">
                  <div class="btn-title">Export HD</div>
                  <div class="btn-subtitle">Free for testing</div>
                </div>
              </button>
            </div>
            
          </div>

          <!-- Extend (Smart Continue) -->
          <div class="control-card">
            <div class="card-header">
              <h3>Extend</h3>
            </div>
            <div class="action-buttons" style="gap:10px;">
              <button id="continue-btn" class="btn btn-dark btn-large">
                <span class="btn-icon">‚ûï</span>
                <div class="btn-content">
                  <div class="btn-title">Make it longer</div>
                  <div class="btn-subtitle">Smart Continue (+8s)</div>
                </div>
              </button>
              <button id="continue-16-btn" class="btn btn-light btn-large" title="Queue two continuations">
                <div class="btn-content">
                  <div class="btn-title">+16s</div>
                  <div class="btn-subtitle">2√ó Smart Continue</div>
                </div>
              </button>
              <button id="continue-24-btn" class="btn btn-light btn-large" title="Queue three continuations">
                <div class="btn-content">
                  <div class="btn-title">+24s</div>
                  <div class="btn-subtitle">3√ó Smart Continue</div>
                </div>
              </button>
            </div>
            <details class="advanced-toggle" style="margin-top:10px;">
              <summary>Tweak continuation (optional)</summary>
              <textarea id="continue-tweak" class="modern-textarea" placeholder="Small nudge only (e.g., 'slowly zoom out', 'soft golden lighting', 'gentle rightward pan')"></textarea>
              <div id="continue-chips" style="display:flex; flex-wrap:wrap; gap:6px; margin-top:8px;">
                <button class="btn btn-light" type="button" data-tweak="slow dolly forward">Slow dolly forward</button>
                <button class="btn btn-light" type="button" data-tweak="gentle zoom out">Gentle zoom out</button>
                <button class="btn btn-light" type="button" data-tweak="pan right">Pan right</button>
                <button class="btn btn-light" type="button" data-tweak="pan left">Pan left</button>
                <button class="btn btn-light" type="button" data-tweak="tilt up">Tilt up</button>
                <button class="btn btn-light" type="button" data-tweak="track left">Track left</button>
                <button class="btn btn-light" type="button" data-tweak="cut to wider framing">Cut to wide</button>
                <button class="btn btn-light" type="button" data-tweak="soft golden hour lighting">Golden hour</button>
                <button class="btn btn-light" type="button" data-tweak="subtle wind movement">Subtle wind</button>
                <button class="btn btn-light" type="button" data-tweak="hold steady">Hold steady</button>
                <button class="btn btn-light" type="button" data-tweak="">Clear</button>
              </div>
            </details>
            <div class="settings-grid" style="gap: 10px; margin-top: 10px;">
              <div class="setting-item">
                <label class="setting-label">Seam</label>
                <div style="display:flex; gap:10px; align-items:center;">
                  <label style="font-size:12px;"><input type="radio" name="seam-mode" value="crossfade" checked> Crossfade</label>
                  <label style="font-size:12px;"><input type="radio" name="seam-mode" value="cut"> Hard cut</label>
                </div>
              </div>
              <div class="setting-item">
                <label for="overlap" class="setting-label">Overlap</label>
                <div style="display:flex; align-items:center; gap:8px;">
                  <input id="overlap" type="range" min="0" max="2" step="0.1" value="1.0" style="width:160px;" />
                  <span id="overlap-value" style="font-size:12px; width:38px; text-align:right;">1.0s</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Legacy button for backward compatibility -->
          <button id="generate-btn" class="btn btn-light" style="display: none;">Generate (Legacy)</button>

          <!-- History Section -->
          <div class="control-card">
            <div class="card-header">
              <h3>Recent Generations</h3>
            </div>
            <div id="history" class="history-grid" aria-live="polite"></div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <script type="module">
    import { guardPage, auth } from '/auth.js';
    guardPage();
    // Expose an ID token getter for non-module scripts
    window.clarioGetIdToken = async () => {
      const u = auth.currentUser;
      if(!u) return null;
      return await u.getIdToken();
    };
  </script>
  <script type="module" src="/video.js"></script>
  <script type="module" src="/header-auth.js" defer></script>
</body>
</html>
